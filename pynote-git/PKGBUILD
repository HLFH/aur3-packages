# Maintainer: Stefan Tatschner <stefan@sevenbyte.org>

pkgbase=pynote-git
pkgname=('pynote-git' 'pynote-docs-git')
_pkgname=pynote
pkgver=0.2.2.r83.g2dca59f
pkgrel=1
arch=('any')
url="https://github.com/rumpelsepp/pynote"
license=('MIT')
source=("${_pkgname}::git+https://github.com/rumpelsepp/${_pkgname}.git")
md5sums=('SKIP')
install=pynote.install

pkgver() {
  cd "$srcdir/${_pkgname}"
  git describe --long | sed -E 's/([^-]*-g)/r\1/;s/-/./g'
  #printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

package_pynote-git() {
  pkgdesc="Manage notes on the commandline"
  depends=('python' 'python-plaintable' 'python-click' 'python-babel')
  optdepends=('python-pygments: synthax highlighting support')
  makedepends=('git' 'python-setuptools')
  conflicts=('pynote')
  provides=('pynote')

  cd "${srcdir}/${_pkgname}"
  python setup.py install --prefix=/usr --root="${pkgdir}" --optimize=1
}

package_pynote-docs-git() {
  pkgdesc="Manpages and HTML documentation for pynote"
  depends=()
  makedepends=('git' 'python-sphinx')
  conflicts=('pynote-docs')
  provides=('pynote-docs')

  cd "${srcdir}/${_pkgname}"/doc
  make man
  make html

  mkdir -p ${pkgdir}/usr/share/man/man5/
  mkdir -p ${pkgdir}/usr/share/doc/pynote/

  cp -ra man/noterc.5 ${pkgdir}/usr/share/man/man5/noterc.5
  cp -ra html/* ${pkgdir}/usr/share/doc/pynote/
}
